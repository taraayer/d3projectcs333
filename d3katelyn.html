<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS 333: Assignment 3</title>

    <!-- D3 -->
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <!-- Bootstrap 4 CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
    <h1 style="position:relative; left: 50px; top: 50px">CS 333: Assignment 3</h1>

    <!-- Create a div where the graph will take place -->
    <div id="plots"></div> 

    <div id="container"></div>
    
    <!-- Dropdown menu for variable selection -->
    <br><br><br>

    <div id="variableSelection" class="dropdown" style="position:absolute; right: 50px">
        <button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown">
            Variable Selection
        </button>
        
            <div class="dropdown-menu">
                <label class="dropdown-item">
                    <input type="checkbox" class="var-check" value = "energy"> Energy
                </label>
                <label class="dropdown-item">
                    <input type="checkbox" class="var-check" value = "tempo"> Tempo
                </label>
                <label class="dropdown-item">
                    <input type="checkbox" class="var-check" value = "danceability"> Danceability
                </label>
                <label class="dropdown-item">
                    <input type="checkbox" class="var-check" value = "loudness"> Loudness
                </label>
                <label class="dropdown-item">
                    <input type="checkbox" class="var-check" value = "valence"> Cheeriness
                </label>
                <label class="dropdown-item">
                    <input type="checkbox" class="var-check" value = "speechiness"> Speechiness
                </label>
                <label class="dropdown-item">
                    <input type="checkbox" class="var-check" value = "duration_ms"> Duration
                </label>
                <label class="dropdown-item">
                    <input type="checkbox" class="var-check" value = "track_popularity"> Track Popularity
                </label>
            </div>

    </div>

    <br><br>

    <!-- Dropdown menu for genre selection -->
    <div id = "genreSelection" class="dropdown" style="position:absolute; right: 50px">
        <button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown">
            Genre Selection
        </button>
            <div class="dropdown-menu" style="max-height:200px; overflow-y: auto;">
                <label class="dropdown-item"><input type="checkbox" class="var-check" value="Pop"> Pop</label>
                <label class="dropdown-item"><input type="checkbox" class="var-check" value="Rock"> Rock</label>
                <label class="dropdown-item"><input type="checkbox" class="var-check" value="Jazz"> Jazz</label>
                <label class="dropdown-item"><input type="checkbox" class="var-check" value="Classical"> Classical</label>
                <label class="dropdown-item"><input type="checkbox" class="var-check" value="Hip-Hop"> Hip-Hop</label>
                <label class="dropdown-item"><input type="checkbox" class="var-check" value="Afrobeats"> Afrobeats</label>
                <label class="dropdown-item"><input type="checkbox" class="var-check" value="Latin"> Latin</label>
                <label class="dropdown-item"><input type="checkbox" class="var-check" value="Indian"> Indian</label>
                <label class="dropdown-item"><input type="checkbox" class="var-check" value="Country"> Country</label>
                <label class="dropdown-item"><input type="checkbox" class="var-check" value="R&B"> R&B</label>
                <label class="dropdown-item"><input type="checkbox" class="var-check" value="Electronic"> Electronic</label>
                <label class="dropdown-item"><input type="checkbox" class="var-check" value="Soul"> Soul</label>
                <label class="dropdown-item"><input type="checkbox" class="var-check" value="Gaming"> Gaming</label>
                <label class="dropdown-item"><input type="checkbox" class="var-check" value="J-Pop"> J-Pop</label>
                <label class="dropdown-item"><input type="checkbox" class="var-check" value="Metal"> Metal</label>
                <label class="dropdown-item"><input type="checkbox" class="var-check" value="Reggae"> Reggae</label>
                <label class="dropdown-item"><input type="checkbox" class="var-check" value="K-Pop"> K-Pop</label>
                <label class="dropdown-item"><input type="checkbox" class="var-check" value="Arabic"> Arabic</label>
                <label class="dropdown-item"><input type="checkbox" class="var-check" value="Punk"> Punk</label>
                <label class="dropdown-item"><input type="checkbox" class="var-check" value="Blues"> Blues</label>
                <label class="dropdown-item"><input type="checkbox" class="var-check" value="Folk"> Folk</label>
                <label class="dropdown-item"><input type="checkbox" class="var-check" value="LoFi"> LoFi</label>
                <label class="dropdown-item"><input type="checkbox" class="var-check" value="Brazilian"> Brazilian</label>
                <label class="dropdown-item"><input type="checkbox" class="var-check" value="Ambient"> Ambient</label>
                <label class="dropdown-item"><input type="checkbox" class="var-check" value="Korean"> Korean</label>
                <label class="dropdown-item"><input type="checkbox" class="var-check" value="World"> World</label>
                <label class="dropdown-item"><input type="checkbox" class="var-check" value="Indie"> Indie</label>
            </div>
    </div>

    <!-- Slider for popularity -->
    <br><br>
    <label style="position:absolute; right: 50px" for="pop_max_slider">Max Popularity: <span id="maxSliderValue">68</span></label>
    <br>
    <input style="position:absolute; right: 50px" type="range" id="pop_max_slider" min="68" max="100" value="68">
   
    <br><br>
    <label style="position:absolute; right: 50px" for="pop_min_slider">MinPopularity: <span id="minSliderValue">68</span></label>
    <br>
    <input style="position:absolute; right: 50px" type="range" id="pop_min_slider" min="68" max="100" value="68">

<script>

    //          HELPER FUNCTIONS         //
    // updates graphs 
    function update(filteredData) {
        console.log(filteredData);
    }

    // get selected variables from drop down menus
    function getSelectedVariables(dropdownMenu) {
        // Find all checked boxes with class 'var-check'
        const selected = dropdownMenu.querySelectorAll(".var-check:checked");
        // Return their values in an array
        return Array.from(selected).map(d => d.value);
    }
    
    // AFTER DATA IMPORTED
    d3.csv("spotifydata.csv").then(function(data) {
        console.log("Loaded CSV:", data);

        // Convert popularity column to number
        data.forEach(d => d.popularity = +d.popularity);

        const maxSlider = document.getElementById("pop_max_slider");
        const maxSliderValue = document.getElementById("maxSliderValue");

        const minSlider = document.getElementById("pop_min_slider");
        const minSliderValue = document.getElementById("minSliderValue");

        const container = document.getElementById("container");

        const variableSelection = document.getElementById("variableSelection")
        const genreSelection = document.getElementById("genreSelection")

        // Store current popularity threshold
        let currMaxPop = Number(maxSlider.value);
        let currMinPop = Number(minSlider.value);

        
        // Initial display
        update(data);

        // Update on max slider change
        maxSlider.addEventListener("input", () => {
            let newMax = Number(maxSlider.value);

            // Ensure max is not smaller than min
            if (newMax < currMinPop) {
                newMax = currMinPop;
                maxSlider.value = newMax;
            }

            currMaxPop = newMax;
            maxSliderValue.textContent = currMaxPop;

            console.log(currMaxPop);

            // Filter between min and max
            const filtered = data.filter(item => item.track_popularity >= currMinPop && item.track_popularity <= currMaxPop);
            update(filtered);
        });

        // Update on min slider change
        minSlider.addEventListener("input", () => {
            let newMin = Number(minSlider.value);

            // Ensure min is not bigger than max
            if (newMin > currMaxPop) {
                newMin = currMaxPop;
                minSlider.value = newMin;
            }

            currMinPop = newMin;
            minSliderValue.textContent = currMinPop;

            console.log(currMinPop);

            // Filter data between min and max
            const filtered = data.filter(item => item.track_popularity >= currMinPop && item.track_popularity <= currMaxPop);
            update(filtered);
        });

        // For Variable Selection
        variableSelection.addEventListener("change", (event) => {
            if (event.target.classList.contains("var-check")) {
                const variables = getSelectedVariables(variableSelection);
                console.log("Selected Variables:", variables);
                // Call update or other logic here if needed
            }
        });

        // For Genre Selection
        genreSelection.addEventListener("change", (event) => {
            if (event.target.classList.contains("var-check")) {
                const selectedGenres = getSelectedVariables(genreSelection);
                console.log("Selected Genres:", selectedGenres);
                // Call update or filtering logic here
            }
        });

    });

</script>


    <!-- Load JS in correct order -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

</body>
</html>
